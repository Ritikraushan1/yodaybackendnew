{% extends "admin/layout.njk" %}
{% set active = "tickets" %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">All Tickets</h1>

<!-- ✅ Alert Message -->
<div id="alertBox" class="hidden mb-4 p-3 rounded-lg text-white text-sm font-medium"></div>

<div class="bg-white p-6 rounded-2xl shadow-lg overflow-x-auto">
  <table class="w-full text-left border-collapse">
    <thead>
      <tr class="border-b bg-gray-50 text-sm text-gray-600">
        <th class="p-2 text-center">#</th>
        <th class="p-2">Username</th>
        <th class="p-2">Title</th>
        <th class="p-2">Content</th>
        <th class="p-2 text-center">Raised Date</th>
        <th class="p-2 text-center">Status</th>
      </tr>
    </thead>
    <tbody>
      {% if tickets and tickets.length %}
        {% for ticket in tickets %}
        <tr id="ticket-{{ ticket.id }}" class="border-b hover:bg-gray-50 transition text-sm">
          <!-- Serial Number -->
          <td class="p-2 text-center text-gray-500">{{ loop.index }}</td>

          <!-- Username -->
          <td class="p-2 font-medium text-gray-800">
            {{ ticket.user_name or "Unknown User" }}
          </td>

          <!-- Title -->
          <td class="p-2 text-gray-700 font-semibold">
            {{ ticket.title or "—" }}
          </td>

          <!-- Content -->
          <td class="p-2 text-gray-600 max-w-md truncate">
            {{ ticket.content or "—" }}
          </td>

          <!-- Raised Date -->
          <td class="p-2 text-center text-gray-500">
            {% if ticket.raised_date %}
              {{ ticket.raised_date.toISOString().slice(0, 19).replace('T', ' ') }}
            {% else %}
              —
            {% endif %}
          </td>

          <!-- Status -->
          <td class="p-2 text-center">
            <span class="px-2 py-1 rounded-full text-xs 
              {% if ticket.status == 'pending' %} bg-yellow-100 text-yellow-700
              {% elseif ticket.status == 'resolved' %} bg-green-100 text-green-700
              {% elseif ticket.status == 'closed' %} bg-red-100 text-red-700
              {% else %} bg-gray-100 text-gray-600 {% endif %}">
              {{ ticket.status | capitalize }}
            </span>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" class="p-4 text-center text-gray-500 italic">
            No tickets found
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

<!-- ✅ JS Alert Helper -->
<script>
  function showAlert(message, color = 'green') {
    const alertBox = document.getElementById('alertBox');
    alertBox.textContent = message;
    alertBox.className = \`mb-4 p-3 rounded-lg text-white text-sm font-medium bg-\${color}-600\`;
    alertBox.classList.remove('hidden');
    setTimeout(() => alertBox.classList.add('hidden'), 2000);
  }
</script>
{% endblock %}
